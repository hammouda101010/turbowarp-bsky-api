<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <title>TurboButterfly OAuth Callback</title>
    <link rel="stylesheet" href="src/styles/auth.css">
    <link rel="apple-touch-icon" sizes="180x180" href="static/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/icons/favicon-16x16.png">
    <link rel="manifest" href="static/icons/site.webmanifest">
  </head>
  <body>
    <p id="auth_result">Processing authentication...</p>
  </body>
  <script>
    // Extract the authorization code from the URL
    const urlParams = new URLSearchParams(window.location.search);

    console.log("Url Params:")
    console.log(urlParams)

    const authCode = urlParams.get('code');

    // Send the authorization code to the main application
    try{
      if (window.opener) {
        window.opener.postMessage({ authCode }, window.location.origin);
        window.close();

      } else {
        throw new Error('No opener window found.');
      }
    }catch(e){
      const auth_result = document.getElementById("auth_result")
      auth_result.innerHTML = `Something Went Wrong: ${e.message.includes("Error: No opener window found.") ? e : "Not a Popup Window (Reason: Couldn't Find an Opener Window.)"}`
      auth_result.style.color = "red"
  }
  </script>
</html>
